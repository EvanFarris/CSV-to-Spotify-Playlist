# CSV-to-Spotify-Playlist

## Purpose

Converts the uri_only file from [Spotify-JSON-to-CSV](https://github.com/EvanFarris/Spotify-JSON-to-CSV) into a spotify playlist that gets added to a user's account.

## Requirements

This project is run on Ubuntu 22.04.

There are five major components needed for this program to work
1. Buy (or use) a domain and create an A record pointed to the ip of the machine that hosts the program.
2. A SSL certificate, a free one can be generated by [Let's Encypt](https://letsencrypt.org)
3. Configure the host machine to use a reverse proxy (ex. Nginx), an explanation is further down the file.
4. Must create a Spotify account and [create an app](https://developer.spotify.com/dashboard/applications)
5. A .env file

A domain is needed in cases where APIs require a redirect url to return the data requested from an API call. An individual IP address is normally not sufficient. Purchase one from a domain broker such as GoDaddy, Namecheap, Google Domains, etc.

The SSL certificate __might__ be optional (I haven't tested it without a ssl certificate), depending on Spotify's API, which may require the use of it. **However** it is more secure, and since this program generates an access token which edits a user's list of playlists, **if the access token is intercepted by the wrong person, could lead to a user having all their playlists deleted**

The reverse proxy in this use case connects the request to the application, redirecting the request to the port number the program is listening to on localhost.

Since we need to use Spotify's API to add the playlist to a user's account, we need to register an account, and create an application. This allows us to interact with the API, through the use of the application id and secret.

To avoid uploading sensitive information like the application id/secret, we store the data in a .env file, and it is not uploaded to git. In this project, it is structured like the code below.

```
SPOTIFY_CLIENT_ID=123456abcdef7890...
SPOTIFY_CLIENT_SECRET=789012345...
SPOTIFY_REDIRECT_LOGIN=https://www.domainname.domainending/spotify/login
SPOTIFY_REDIRECT_LOGIN_CALLBACK=https://www.domainname.domainending/spotify/login_callback
PORT=2345
```

The first two lines above are the application id and secret given from Spotify. Line three is the landing page that redirects the user to Spotify's OAuth page, while line 4 is the callback for that. Line 5 is the port that the webserver will be listening on.

## Usage

**Currently, this a proof of concept project, rather than an actual functional, user-friendly program**
Start the program

> node index.js

1. Place the uri_only file into the csvToUpload folder, be sure that it is the only file in the folder.
2. Have the user who wants the playlist navigate to the page you set as the SPOTIFY_REDIRECT_LOGIN
3. The user logs into spotify, and the user agrees to allow editing of playlists.
4. The user waits until the webpage updates with either a success or failure message.
5. Check spotify to see if the song was created.

## Pitfalls

It's barebones at the moment. 
- Requires manual placement of the uri file into the folder, meaning only one playlist can be added at a time.
- No pretty web page currently, as I think I would need to learn how to associate a user with a request, unless I think of a workaround.

## Future plans
- Integrate this project with [Spotify-JSON-to-CSV](https://github.com/EvanFarris/Spotify-JSON-to-CSV) and create a useful service

## Nginx setup
1. Install nginx
2. Configure /etc/nginx/sites-available/default to listen on ssl, install the ssl certificate, and setup the reverse proxy
```
server {
	listen 443 ssl;
	listen [::]:443 ssl;
	server_name DOMAIN_NAME;
	ssl_certificate /etc/letsencrypt/live/certificate-folder/fullchain.pem;
	ssl_certificate /etc/letsencrypt/live/certificate-folder/privkey.pem;
	location /spotify {
		proxy_pass http://127.0.0.1:PORT_NUMBER/;
	}
}
```

Where __PORT_NUMBER__ is the port you set in .env, and __DOMAIN_NAME__ is the host domain (ex: teggle.dev)

3. Restart Nginx
```
sudo systemctl restart nginx
```
If there is no error output, then everything is fine. Otherwise re-edit /etc/nginx/sites-available/default 

4. Add rules to your firewall to allow traffic 
```
sudo ufw allow `Nginx Full`
```

5. If using a VM on a physical computer on your home network, you may have to port forward any traffic on 443 to your vm's internal network ip (192.168.x.x)
